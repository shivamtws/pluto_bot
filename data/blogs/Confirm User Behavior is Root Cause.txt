Confirm User Behavior is Root Cause of Citrix Latency Using ICA/HDX Channels

Citrix Latency blog originally posted by Citrix CTP, George Spiers. In my recent article Understanding Citrix Latency Metrics to Troubleshoot Remote Worker Issues, I explained some causes to “Citrix is slow” complaints and delved into the latency metrics that are available to assist with troubleshooting. Another area we can look at is the ICA/HDX virtual channels, which provide the functionality and communication required between a Citrix Workspace app running on an endpoint and a Virtual Apps and Desktops Virtual Delivery Agent running Desktop or Server OS. Citrix Virtual Apps and Desktops ships with a number of virtual channels out of the box. There are virtual channels for:

Audio COM ports Disks Graphics LPT ports Printers Smart cards Video Third-party custom virtual channels

The client running Citrix Workspace app has a number of virtual channel drivers, in the form of DLLs, that are able to communicate with Virtual Apps and Desktops (VDAs) and the applications running on them. Whenever a client connects to Citrix Virtual Apps and Desktops, it passes information about the virtual channels it supports. The VDA is then able to hook into the virtual channel, allowing data to flow, encapsulated in the ICA stream. Some virtual channels are required for normal operation, while some others are optional and there to provide additional functionality if required. There can also be multiple virtual channels active at one time (Image 1).

Image 1: ICA/HDX virtual channels are present in an end-user session when the user has such behavior as listening to audio, watching video, or using a 3rd party peripheral device like a printer or thumb drive.

How can we monitor Citrix ICA virtual channels to our advantage? Citrix ICA virtual channels might not be something you often think about when troubleshooting, but there are scenarios where having insight into them can help aid finding root cause of end user issues. There are also 3rd party tools, like Goliath Technologies, that make finding and using ICA/HDX channel data easier (Image 2).

 

Image 2: Goliath monitors all relevant ICA/HDX Virtual Channels and their performance for each individual user session. This way IT Pros can use the data to prove user behavior is root cause of end user experience issues.

With almost everyone now working from home due to stay-at-home requirements, we hear a number of common complaints from our end users such as:

Audio playback is muffled, choppy, or not clear. Video playback is buffering or not clear. Printing is not working or takes a long time. Client drives are not accessible.

These behaviors are all supported by Citrix ICA/HDX Virtual Channels. Understanding their metrics can provide insight into what a user is doing when experiencing performance issues. Typically for these requests, you may start checking over Citrix Policies, asking the user to upgrade their Workspace app to the latest version or to try logging off and on again. Instead, why not take a look at virtual channel monitoring data? It might actually give you some clues as to what the root cause is.   Example 1: Audio quality is poor In this example, an end-user calls the help desk and reports that since working from home, audio performance is poor. Whenever playing audio files from her remote desktop, the audio is choppy and sometimes skips. Upon investigating the Audio virtual channel while the user is playing back audio, you can see that the output bandwidth being used is rather low and is the cause of poor audio performance. This was caused by the Audio quality Citrix policy being set to Low – for low-speed connections. Setting to Medium allows for increased throughput gains and better audio quality. Without witnessing the low output bandwidth, it may not have been evident that a policy setting was incorrectly set. Third-party software can better visualize ICA/HDX virtual channel information for IT Pros, making it even easier to troubleshoot issues. Below is a screenshot from Goliath Technologies where at a glance you can see not only is ICA RTT spiking above industry best practice thresholds, but it is doing so at the same time the Audio BW Out channel is seeing a spike. As an IT Pro, you know this user is consuming too much audio bandwidth which is negatively impacting the user’s session. Now IT Pros can talk to the users about their behavior, like listening to Spotify while working, and determine the resolution for slowness.

 

Image 3: Goliath correlates latency metrics from all ICA/HDX channels, enabling IT admins to isolate and prove root cause of remote worker issues quickly. In the use case above, the root cause of slow performance is due to the user’s behavior using too much audio bandwidth within their session.

Example 2: Client drives are not accessible In this example, an end user calls the help desk and reports that his client drives are not visible when using Epic Hyperspace, the organization’s Electronic Health Record system. This is preventing the end user from importing documents into Epic. As the Citrix administrator reviews the virtual channels running under the affected user’s session, he notices that the Client Drive Mapping virtual channel is Idle. This wasn’t necessarily expected, but upon further investigation was due to the Client drive redirection policy being prohibited for Citrix Gateway connections, which can be quite common as a security measure against external connections into Virtual Apps and Desktops. The administrator saved time by first checking the state of the virtual channels and then, with the evidence, reviewing the Citrix policy configuration for external users.

Example 3: Printing is slow Printing is one of the most widely used functionalities within Citrix Virtual Apps and Desktops, and the ICA Printing virtual channel takes care of mapping printers into sessions and transferring print jobs to endpoint printers or print servers. In this example, an end user calls the help desk and reports that printing is much slower now than when in the office. By monitoring the printing virtual channel, a Citrix administrator was able to track print jobs and the bandwidth that the print jobs were utilizing. The bandwidth utilization was low and therefore the cause of poor printing performance. What the Citrix administrator also noticed is that the Thinwire virtual channel was consuming a lot of bandwidth. This evidence allowed the administrator to have an informed conversation with the end user and discover that the user was watching a training video while attempting to print, which was contending for overall session bandwidth. In this example, the user was able to print once video playback was stopped. Alternatively, the Citrix administrator could have raised bandwidth limits via Citrix policies to solve this issue. By looking deeper into ICA/HDX channels, IT Pros can more quickly isolate and prove root cause of poor session performance isn’t always Citrix, but the end users behavior while using Citrix.

About Goliath Technologies Goliath Technologies offers software that is purpose-built for monitoring and troubleshooting end user experience issues, and can more easily correlate and present ICA/HDX virtual channel metrics alongside all other potential metrics that could impact performance. To learn more on Goliath, email techinfo@goliathtechnologies.com to set up a demo.